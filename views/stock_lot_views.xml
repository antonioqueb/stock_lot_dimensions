<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Vista de formulario mejorada del lote -->
    <record id="view_production_lot_form_inherit" model="ir.ui.view">
        <field name="name">stock.lot.form.inherit.dimensions</field>
        <field name="model">stock.lot</field>
        <field name="inherit_id" ref="stock.view_production_lot_form"/>
        <field name="arch" type="xml">
            <!-- Agregar botón smartbutton para ver fotografías -->
            <div name="button_box" position="inside">
                <button class="oe_stat_button" 
                        type="object" 
                        name="action_view_images" 
                        icon="fa-camera"
                        invisible="x_cantidad_fotos == 0">
                    <field name="x_cantidad_fotos" widget="statinfo" string="Fotos"/>
                </button>
            </div>

            <!-- Campos invisibles computados -->
            <field name="product_id" position="after">
                <field name="x_tiene_fotografias" invisible="1"/>
                <field name="x_fotografia_principal" invisible="1"/>
            </field>

            <!-- Sección de Dimensiones y Características -->
            <xpath expr="//group[@name='main_group']" position="after">
                <notebook>
                    <page string="Dimensiones y Características" name="dimensions">
                        <group>
                            <group string="Dimensiones" name="dimensions_group">
                                <field name="x_grosor" 
                                       widget="float" 
                                       placeholder="0.00"/>
                                <field name="x_alto" 
                                       widget="float" 
                                       placeholder="0.0000"/>
                                <field name="x_ancho" 
                                       widget="float" 
                                       placeholder="0.0000"/>
                            </group>

                            <group string="Características" name="characteristics_group">
                                <!-- <field name="x_acabado" 
                                       placeholder="Selecciona un acabado..."/> -->
                                <field name="x_formato" 
                                       placeholder="Selecciona un formato..."/>
                                <field name="x_bloque" 
                                       placeholder="Identificación del bloque"/>
                            </group>
                        </group>

                        <group string="Detalles Adicionales" name="details_group">
                            <field name="x_detalles_placa" 
                                   placeholder="Detalles especiales: rota, barreno, release, etc."
                                   nolabel="1"/>
                        </group>
                    </page>

                    <page string="Fotografías" name="photos" invisible="x_cantidad_fotos == 0">
                        <field name="x_fotografia_ids" 
                               widget="image_gallery" 
                               mode="kanban" 
                               nolabel="1">
                            <kanban class="o_kanban_mobile">
                                <field name="id"/>
                                <field name="name"/>
                                <field name="image"/>
                                <field name="sequence"/>
                                <templates>
                                    <t t-name="kanban-box">
                                        <div class="oe_kanban_global_click o_kanban_record_has_image_fill">
                                            <div class="o_kanban_image">
                                                <img t-att-src="kanban_image('stock.lot.image', 'image', record.id.raw_value)" 
                                                     alt="Foto" 
                                                     class="o_image_64_cover"/>
                                            </div>
                                            <div class="oe_kanban_details">
                                                <strong class="o_kanban_record_title">
                                                    <field name="name"/>
                                                </strong>
                                                <div class="o_kanban_record_subtitle">
                                                    <field name="notas"/>
                                                </div>
                                            </div>
                                        </div>
                                    </t>
                                </templates>
                            </kanban>
                            <form string="Fotografía">
                                <sheet>
                                    <group>
                                        <field name="name"/>
                                        <field name="sequence"/>
                                    </group>
                                    <group>
                                        <field name="image" widget="image" class="oe_avatar"/>
                                    </group>
                                    <group>
                                        <field name="notas" placeholder="Notas adicionales..."/>
                                    </group>
                                </sheet>
                            </form>
                        </field>
                    </page>
                </notebook>
            </xpath>
        </field>
    </record>

    <!-- Vista tree de lotes con dimensiones -->
    <record id="view_production_lot_tree_inherit" model="ir.ui.view">
        <field name="name">stock.lot.tree.inherit.dimensions</field>
        <field name="model">stock.lot</field>
        <field name="inherit_id" ref="stock.view_production_lot_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='product_id']" position="after">
                <field name="x_grosor" optional="hide" string="Grosor (cm)"/>
                <field name="x_alto" optional="hide" string="Alto (m)"/>
                <field name="x_ancho" optional="hide" string="Ancho (m)"/>
                <!-- <field name="x_acabado" optional="show" string="Acabado"/> -->
                <field name="x_bloque" optional="show" string="Bloque"/>
                <field name="x_formato" optional="show" string="Formato"/>
                <field name="x_fotografia_principal" 
                       widget="image_preview" 
                       options="{'size': [60, 60]}" 
                       optional="hide"/>
                <field name="x_cantidad_fotos" optional="show" string="Fotos"/>
            </xpath>
        </field>
    </record>

</odoo>