<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Vista tree de ubicaciones con dimensiones y hold -->
    <record id="view_stock_quant_tree_inherit" model="ir.ui.view">
        <field name="name">stock.quant.tree.inherit.dimensions</field>
        <field name="model">stock.quant</field>
        <field name="inherit_id" ref="stock.view_stock_quant_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='lot_id']" position="after">
                <field name="x_grosor" optional="hide" string="Grosor (cm)"/>
                <field name="x_alto" optional="hide" string="Alto (m)"/>
                <field name="x_ancho" optional="hide" string="Ancho (m)"/>
                <field name="x_bloque" optional="show" string="Bloque"/>
                <field name="x_formato" optional="show" string="Formato"/>
                <field name="x_fotografia_principal" widget="image_preview" options="{'size': [60, 60]}" optional="hide"/>
                <field name="x_cantidad_fotos" optional="show" string="Fotos"/>
                
                <!-- Campos invisibles necesarios para el widget -->
                <field name="x_esta_reservado" column_invisible="1"/>
                <field name="x_en_orden_entrega" column_invisible="1"/>
                <field name="x_tiene_detalles" column_invisible="1"/>
                <field name="x_detalles_placa" column_invisible="1"/>
                
                <!-- NUEVOS CAMPOS DE HOLD -->
                <field name="x_tiene_hold" column_invisible="1"/>
                <field name="x_hold_para" optional="show" string="Hold Para"/>
                <field name="x_hold_dias_restantes" optional="show" string="Días Hold"
                       decoration-danger="x_tiene_hold and x_hold_dias_restantes &lt;= 3"
                       decoration-warning="x_tiene_hold and x_hold_dias_restantes &lt;= 5 and x_hold_dias_restantes &gt; 3"/>
                
                <!-- Columna de estado con iconos -->
                <field name="estado_placa" 
                       string="Estado" 
                       widget="status_icons" 
                       nolabel="1"
                       optional="show"/>
            </xpath>
        </field>
    </record>

    <!-- Vista tree editable (para ubicaciones) con botones de hold -->
    <record id="view_stock_quant_tree_editable_inherit" model="ir.ui.view">
        <field name="name">stock.quant.tree.editable.inherit.dimensions</field>
        <field name="model">stock.quant</field>
        <field name="inherit_id" ref="stock.view_stock_quant_tree_editable"/>
        <field name="arch" type="xml">
            <!-- Agregar campos después de lot_id -->
            <xpath expr="//field[@name='lot_id']" position="after">
                <field name="x_grosor" optional="hide" string="Grosor (cm)" readonly="1"/>
                <field name="x_alto" optional="hide" string="Alto (m)" readonly="1"/>
                <field name="x_ancho" optional="hide" string="Ancho (m)" readonly="1"/>
                <field name="x_bloque" optional="show" string="Bloque" readonly="1"/>
                <field name="x_formato" optional="show" string="Formato" readonly="1"/>
                <field name="x_fotografia_principal" widget="image_preview" options="{'size': [60, 60]}" optional="hide" readonly="1"/>
                <field name="x_cantidad_fotos" optional="show" string="Fotos" readonly="1"/>
                
                <!-- Campos invisibles necesarios para el widget -->
                <field name="x_esta_reservado" column_invisible="1"/>
                <field name="x_en_orden_entrega" column_invisible="1"/>
                <field name="x_tiene_detalles" column_invisible="1"/>
                <field name="x_detalles_placa" column_invisible="1"/>
                
                <!-- NUEVOS CAMPOS DE HOLD -->
                <field name="x_tiene_hold" column_invisible="1"/>
                <field name="x_hold_para" optional="show" string="Hold Para" readonly="1"/>
                <field name="x_hold_dias_restantes" optional="show" string="Días Hold" readonly="1"
                       decoration-danger="x_tiene_hold and x_hold_dias_restantes &lt;= 3"
                       decoration-warning="x_tiene_hold and x_hold_dias_restantes &lt;= 5 and x_hold_dias_restantes &gt; 3"/>
                
                <!-- Columna de estado con iconos -->
                <field name="estado_placa" 
                       string="Estado" 
                       widget="status_icons" 
                       nolabel="1"
                       optional="show"
                       readonly="1"/>
            </xpath>
            
            <!-- Agregar botones de HOLD después del botón de Replenishment -->
            <xpath expr="//button[@name='action_view_orderpoints']" position="after">
                <!-- Botón para crear hold (solo si no tiene hold activo) -->
                <button name="action_crear_hold" 
                        string="Reservar Lote" 
                        type="object" 
                        class="btn-link text-success" 
                        icon="fa-lock"
                        invisible="not lot_id or x_tiene_hold"
                        help="Crear reserva manual para este lote"/>
                
                <!-- Botón para ver hold (solo si tiene hold activo) -->
                <button name="action_ver_hold" 
                        string="Ver Reserva" 
                        type="object" 
                        class="btn-link text-info" 
                        icon="fa-eye"
                        invisible="not x_tiene_hold"
                        help="Ver detalles de la reserva activa"/>
                
                <!-- Botón para cancelar hold (solo si tiene hold activo) -->
                <button name="action_cancelar_hold" 
                        string="Cancelar Hold" 
                        type="object" 
                        class="btn-link text-danger" 
                        icon="fa-times"
                        invisible="not x_tiene_hold"
                        confirm="¿Está seguro de cancelar esta reserva?"
                        help="Cancelar la reserva activa"/>
                
                <!-- Botones existentes de fotos -->
                <button name="action_add_photos" 
                        string="Agregar Foto" 
                        type="object" 
                        class="btn-link" 
                        icon="fa-camera"
                        invisible="not lot_id"/>
                <button name="action_view_lot_photos" 
                        string="Ver Fotos" 
                        type="object" 
                        class="btn-link" 
                        icon="fa-picture-o"
                        invisible="not lot_id or not x_cantidad_fotos"/>
            </xpath>
        </field>
    </record>
</odoo>